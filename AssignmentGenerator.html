<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Assess ‚Äì Assignment Generator</title>
  <link rel="stylesheet" href="lessonplan.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="navbar-wrapper">
    <header class="navbar">
      <div class="navbar-content">
        <div class="logo-container">
          <img src="logo.svg" alt="Smart Assess Logo" class="logo-img" style="height: 60px; width: 80px" />
        </div>
        <div class="nav-actions">
          <button onclick="window.location.href='index.html'" class="btn-light">‚Üê Back to Grader</button>
        </div>
      </div>
    </header>
  </div>

  <main class="hero-container">
    <section class="hero-content">
      <h1 class="hero-title">Assignment Generator</h1>
      <p class="hero-subtitle">Design assignments aligned to your unit, grade level, and objectives.</p>
    </section>
  </main>

  <section class="grading-form">
    <div class="form-card">
      <form id="assignment-form">
        <div class="form-grid">
          <div class="form-left">
            <div class="form-section">
              <label class="form-label" for="subject">Subject</label>
              <input type="text" id="subject" placeholder="e.g. History, Science, ELA" />
            </div>

            <div class="form-section">
              <label class="form-label" for="grade">Grade Level</label>
              <select id="grade">
                <option value="">Select grade...</option>
                <script>
                  document.write([...Array(12)].map((_, i) => `<option value="${i + 1}">${i + 1}</option>`).join(''));
                </script>
              </select>
            </div>

            <div class="form-section">
              <label class="form-label" for="unit">Unit Title</label>
              <input type="text" id="unit" placeholder="e.g. Civil Rights Movement" />
            </div>

            <div class="form-section">
              <label class="form-label" for="topic">Assignment Topic</label>
              <input type="text" id="topic" placeholder="e.g. Causes of WWII" />
            </div>

            <div class="form-section">
              <label class="form-label" for="objectives">Learning Objectives</label>
              <textarea id="objectives" rows="2" placeholder="What should students learn?"></textarea>
            </div>
          </div>

          <div class="form-right">
            <div class="form-section">
              <label class="form-label">Assignment Features</label>
              <div class="checkbox-group">
                <label><input type="checkbox" name="includeRubric" /> Include Rubric</label>
                <label><input type="checkbox" name="includeInstructions" /> Student Instructions</label>
                <label><input type="checkbox" name="includeScaffoldedSupport" /> Scaffolded Support</label>
                <label><input type="checkbox" name="requireResearch" /> Research Required</label>
                <label><input type="checkbox" name="includeReflection" /> Student Reflection</label>
                <label><input type="checkbox" name="multipleVersions" /> Multiple Versions</label>
              </div>
            </div>
          </div>
        </div>

        <div class="form-section text-center">
          <button type="submit" class="btn-purple">Generate Assignment</button>
          <div id="loader" class="loader" style="margin-top: 12px;"></div>
          <div id="assignment-output" style="margin-top: 16px;"></div>
        </div>
      </form>
    </div>
  </section>

  <script>
    document.getElementById('assignment-form').addEventListener('submit', async function (e) {
      e.preventDefault();

      const subject = document.getElementById('subject').value.trim();
      const grade = document.getElementById('grade').value;
      const unit = document.getElementById('unit').value.trim();
      const topic = document.getElementById('topic').value.trim();
      const objectives = document.getElementById('objectives').value.trim();

      const form = e.target;
      const checkboxes = form.querySelectorAll('input[type="checkbox"]');
      const options = {};
      checkboxes.forEach(cb => options[cb.name] = cb.checked);

      const loader = document.getElementById('loader');
      const output = document.getElementById('assignment-output');
      output.innerHTML = '';
      loader.style.display = 'block';

      try {
        const response = await fetch('https://smartassessbackend.onrender.com/assignment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            subject,
            grade,
            unit,
            topic,
            objectives,
            ...options
          })
        });

        const data = await response.json();
        loader.style.display = 'none';

        if (data.success && data.pdfUrl) {
          const link = document.createElement('a');
          link.href = `https://smartassessbackend.onrender.com${data.pdfUrl}`;
          link.target = '_blank';
          link.textContent = 'üìÑ Download Assignment PDF';
          link.style.display = 'inline-block';
          link.style.fontWeight = '500';
          link.style.color = '#6246ea';
          link.style.textDecoration = 'none';
          output.appendChild(link);
        } else {
          output.textContent = '‚ùå Something went wrong. Please try again.';
          output.style.color = 'red';
        }
      } catch (err) {
        loader.style.display = 'none';
        output.textContent = '‚ö†Ô∏è Error connecting to the server.';
        output.style.color = 'red';
        console.error(err);
      }
    });
  </script>
  <script>
    (function propagateHash() {
      const currentHash = window.location.hash;           // e.g. "#name=Huda&email=..."
      if (!currentHash) return;
  
      // 1) Rewrite all same-origin links to carry the current hash
      document.querySelectorAll('a[href]').forEach(a => {
        const href = a.getAttribute('href');
        if (!href) return;
        // Skip absolute external links, mailto, tel, and pure hash anchors
        if (/^(https?:|mailto:|tel:)/i.test(href) || href.startsWith('#')) return;
  
        // If link already has a hash, append as &‚Ä¶; else add the current hash
        const newHref = href.includes('#')
          ? href + '&' + currentHash.slice(1)
          : href + currentHash;
        a.setAttribute('href', newHref);
      });
  
      // 2) Patch inline button navigations like: onclick="window.location.href='page.html'"
      document.querySelectorAll('[onclick*="window.location.href"]').forEach(el => {
        const m = el.getAttribute('onclick').match(/window\.location\.href\s*=\s*'([^']+)'/);
        if (!m) return;
        const url = m[1];
        const newUrl = url.includes('#')
          ? url + '&' + currentHash.slice(1)
          : url + currentHash;
        el.setAttribute('onclick', `window.location.href='${newUrl}'`);
      });
  
      // 3) Optional helper for future use: <button onclick="navWithHash('lessonplan.html')">
      window.navWithHash = function (url) {
        const h = window.location.hash;
        window.location.href = url + (url.includes('#') ? '&' + h.slice(1) : h);
      };
    })();
  </script>
  
</body>
</html>
